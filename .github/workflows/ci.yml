name: ci

on: push

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-go@v4
      with:
        go-version: stable
    - run: |
        go install ./...
        go test -v ./...
  detect-pii:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: 'google-github-actions/auth@v1'
      with:
        credentials_json: ${{ secrets.GCP_SA_KEY }}
    - uses: 'google-github-actions/setup-gcloud@v1'
    - uses: ./github-action
      with:
        github_token: ${{ secrets.github_token }}
        level: error
